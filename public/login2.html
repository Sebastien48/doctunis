<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        body {
            background-image: url('les-films-incontournables-du-cinema-w_2524x884.jpg');
            background-size: cover;
            background-position: center;
        }
        h1 {
            background-image: url('imagefilm/images.jpg');
            background-size: cover;
            color: transparent;
            text-align: center;
            padding: 20px;
            font-size: 2rem;
            font-weight: bold;
            background-clip: text;
            -webkit-background-clip: text;
        }
    </style>
</head>

<body class="bg-red-600 flex justify-center items-center h-screen">
    <form class="bg-white shadow-lg rounded-lg p-8 w-96" method="post" id="login">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">CONNEXION</h1>

        <div class="relative mb-4">
            <input type="text" name="username" id="username" placeholder="Entrez le nom d'utilisateur"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <i class="bx bxs-user absolute top-1/2 transform -translate-y-1/2 right-3 text-gray-500"></i>
        </div>
        <span id="usernameError" class="text-red-500 text-sm"></span>

        <div class="relative mb-4">
            <input type="password" name="password" id="password" placeholder="Mot de passe"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <i class="bx bxs-lock-alt absolute top-1/2 transform -translate-y-1/2 right-3 text-gray-500"></i>
        </div>
        <span id="passwordError" class="text-red-500 text-sm"></span>

        <div class="flex items-center justify-between mb-4">
            <label class="flex items-center">
                <input type="checkbox" name="remember-me" class="h-4 w-4 text-blue-500 border-gray-300 rounded">
                <span class="ml-2 text-sm text-gray-600">Se souvenir de moi</span>
            </label>
            <a href="#" class="text-sm text-blue-500 hover:underline">Mot de passe oublié ?</a>
        </div>

        <button type="submit" id="envoyer" disabled
            class="w-full py-2 bg-red-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-red-800 transition">
            Continuer
        </button>

        <p class="text-sm text-center text-gray-600 mt-4">
            Vous n'avez pas de compte ?
            <a href="login.html" class="text-blue-500 hover:underline font-semibold">S'inscrire</a>
        </p>
    </form>

    <script>

      const usernameField = document.getElementById('username');
const passwordField = document.getElementById('password');
const submitButton = document.getElementById('envoyer');
const usernameError = document.getElementById('usernameError');
const passwordError = document.getElementById('passwordError');


function validateForm() {
    let isValid = true;

    if (usernameField.value.trim() === '') {
        usernameError.textContent = "Le nom d'utilisateur est requis.";
        isValid = false;
    } else if (usernameField.value.trim().length < 3) {
        usernameError.textContent = "Le nom d'utilisateur doit contenir au moins 3 caractères.";
        isValid = false;
    } else {
        usernameError.textContent = "";
    }

    if (passwordField.value.trim() === '') {
        passwordError.textContent = "Le mot de passe est requis.";
        isValid = false;
    } else if (passwordField.value.trim().length < 6) {
        passwordError.textContent = "Le mot de passe doit contenir au moins 6 caractères.";
        isValid = false;
    } else {
        passwordError.textContent = "";
    }

    submitButton.disabled = !isValid;
}

usernameField.addEventListener('input', validateForm);
passwordField.addEventListener('input', validateForm);
localStorage.setItem("username", username);

document.getElementById('login').addEventListener('submit', async function (event) {
    event.preventDefault();
    validateForm();

    if (!submitButton.disabled) {
        const username = usernameField.value.trim();
        const mot_de_passe = passwordField.value.trim();

        try {
            submitButton.innerHTML = "Connexion...";
            const response = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, mot_de_passe }),
            });

            const result = await response.json();

            if (response.ok) {
                //alert(result.message);

                if (result.redirectTo) {

                    
                    window.location.href = result.redirectTo;
                } else {
                    localStorage.setItem('username', username);

                    window.location.href = '/accueil.html';
                    
                }
            } else {
                passwordError.textContent = result.message || "Erreur d'identification.";
            }
        } catch (error) {
            console.error('Erreur lors de la requête :', error);
            alert('Une erreur est survenue, veuillez réessayer plus tard.');
        } finally {
            submitButton.innerHTML = "Continuer";
        }
    } else {
        alert('Veuillez remplir correctement tous les champs.');
    }
});

    </script>
</body>

</html>
